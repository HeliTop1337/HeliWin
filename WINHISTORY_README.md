# История Выигрышей (Win History)

## Описание
Динамический блок истории последних выигрышей, который отображается над хедером сайта. Показывает реальные выигрыши пользователей из кейсов в режиме реального времени через WebSocket.

## Реализованные функции

### ✅ WebSocket интеграция
- Автоматическое подключение к WebSocket серверу
- Автоматическое переподключение при обрыве связи
- Индикатор статуса подключения (зеленый/красный)

### ✅ Задержка показа выигрышей
- **3 секунды задержки** перед показом выигрыша всем пользователям
- Это предотвращает спойлер анимации открытия кейса для игрока

### ✅ Визуальный дизайн
- Компактные карточки предметов (96x112px)
- Градиентный фон в зависимости от редкости
- Иконка предмета в центре
- Название предмета внизу карточки
- Метка множителя (x19.1) для дорогих выигрышей
- Эффект свечения для редких предметов (LEGENDARY, EXCEPTIONAL)
- Tooltip с подробной информацией при наведении

### ✅ Приоритизация выигрышей
- Автоматическая сортировка по цене (дорогие первыми)
- Отображение до 30 последних выигрышей
- Метки для особых выигрышей:
  - **x[число]** для предметов ≥500₽ (показывает множитель)
  - Желтый цвет для предметов ≥1000₽
  - Оранжевый цвет для предметов ≥500₽
  - Фиолетовый цвет для множителя ≥10x

### ✅ Анимации
- Плавное появление новых карточек
- Автоматическая прокрутка к новым элементам
- Hover эффекты (увеличение, тень)
- Пульсирующее свечение для редких предметов
- Анимация появления метки множителя

## Структура файлов

```
frontend/components/WinHistory.tsx    - Основной компонент
backend/websocket/websocket.gateway.ts - WebSocket сервер
backend/cases/cases.service.ts        - Логика открытия кейсов
frontend/pages/_app.tsx               - Интеграция компонента
```

## Использование

### Автоматическая работа
Компонент автоматически:
1. Подключается к WebSocket при загрузке страницы
2. Получает события `itemDropped` от сервера
3. Ждет 3 секунды перед показом
4. Добавляет выигрыш в ленту с анимацией
5. Сортирует по цене и показывает топ-30

### Тестирование
Для тестирования WebSocket используйте скрипт:

```bash
npx ts-node scripts/test-websocket.ts
```

Скрипт генерирует 10 тестовых выигрышей с интервалом 2 секунды.

## Технические детали

### WebSocket события
```typescript
socket.on('itemDropped', (drop) => {
  id: string;           // Уникальный ID
  username: string;     // Имя пользователя
  itemName: string;     // Название предмета
  itemRarity: string;   // Редкость (COMMON, UNCOMMON, RARE, EXCEPTIONAL, LEGENDARY)
  itemPrice: number;    // Цена предмета
  itemIcon: string;     // Путь к иконке
  caseName: string;     // Название кейса
  timestamp: number;    // Время выигрыша
  multiplier?: number;  // Множитель выигрыша (цена предмета / цена кейса)
});
```

### Редкости и цвета
- **COMMON**: Серый (gray-500)
- **UNCOMMON**: Зеленый (green-500)
- **RARE**: Синий (blue-500)
- **EXCEPTIONAL**: Фиолетовый (purple-500)
- **LEGENDARY**: Желто-оранжевый (yellow-500 to orange-500)

### Размеры карточек
- Ширина: 96px (w-24)
- Высота: 112px (h-28)
- Отступ между карточками: 8px (gap-2)

## Интеграция

Компонент уже интегрирован в `_app.tsx` и отображается над хедером:

```tsx
<WinHistory />
<Header />
<Component {...pageProps} />
```

## Особенности

1. **Не спойлерит анимацию**: 3 секунды задержки дают время игроку увидеть свою анимацию открытия
2. **Адаптивный**: Горизонтальная прокрутка на мобильных устройствах
3. **Производительный**: Ограничение в 30 элементов предотвращает перегрузку
4. **Информативный**: Tooltip показывает полную информацию при наведении
5. **Визуально привлекательный**: Градиенты, свечение, анимации создают премиальный вид

## Возможные улучшения

- [ ] Добавить звуковые эффекты для крупных выигрышей
- [ ] Фильтрация по редкости/цене
- [ ] История выигрышей конкретного пользователя
- [ ] Статистика выигрышей за период
- [ ] Экспорт истории в CSV/JSON

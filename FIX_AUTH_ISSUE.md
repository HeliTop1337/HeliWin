# Исправление ошибки 401 Unauthorized

## Проблема
При открытии кейса возникает ошибка:
```
http://localhost:4000/api/cases/[id]/open 401 (Unauthorized)
```

## Причина
Токен авторизации не добавляется в заголовки HTTP запросов.

## Решение

### 1. Проверьте что вы авторизованы
- Откройте DevTools (F12)
- Перейдите в Application → Local Storage
- Найдите ключ `heliwin-auth`
- Убедитесь что там есть `accessToken`

### 2. Если токена нет - войдите заново
```
1. Перейдите на /login
2. Введите логин и пароль
3. После входа токен должен сохраниться
```

### 3. Если токен есть, но ошибка остается
Перезагрузите страницу (Ctrl+R или F5)

### 4. Проверка работы
```javascript
// Откройте консоль браузера (F12)
// Выполните команду:
localStorage.getItem('heliwin-auth')

// Должен вернуть JSON с accessToken
```

## Что было исправлено

### 1. Добавлена редкость VETERAN
В компонент `WinHistory.tsx` добавлена поддержка редкости VETERAN:
- Цвет: Cyan (голубой)
- Свечение: Среднее
- Эффект пульсации

### 2. Улучшена инициализация токена
В `_app.tsx` исправлена инициализация токена при загрузке приложения.

### 3. Улучшен визуал карточек
- Фон соответствует рангу предмета
- Картинки предметов отображаются корректно
- Добавлены эффекты свечения для редких предметов

## Тестирование

### Проверка авторизации
```bash
# 1. Запустите бэкенд
npm run start:dev

# 2. Запустите фронтенд
cd frontend
npm run dev

# 3. Откройте браузер
http://localhost:3000

# 4. Войдите в систему
Логин: admin
Пароль: admin123

# 5. Откройте кейс
Перейдите на главную → Выберите кейс → Нажмите "Открыть"
```

### Проверка WebSocket
После открытия кейса:
1. Подождите 3 секунды
2. Выигрыш должен появиться в ленте вверху
3. Карточка должна иметь цвет соответствующий редкости
4. Иконка предмета должна отображаться

## Редкости и цвета

| Редкость | Цвет | Описание |
|----------|------|----------|
| COMMON | Серый | Обычные предметы |
| UNCOMMON | Зеленый | Необычные предметы |
| RARE | Синий | Редкие предметы |
| VETERAN | Голубой (Cyan) | Ветеранские предметы |
| EXCEPTIONAL | Фиолетовый | Исключительные предметы |
| LEGENDARY | Желто-оранжевый | Легендарные предметы |

## Дополнительная отладка

### Проверка токена в запросах
```javascript
// Откройте DevTools → Network
// Откройте кейс
// Найдите запрос к /api/cases/[id]/open
// Проверьте Headers → Request Headers
// Должен быть: Authorization: Bearer [token]
```

### Если токен не добавляется
```javascript
// В консоли браузера выполните:
import { useAuthStore } from './store/useAuthStore';
const token = useAuthStore.getState().accessToken;
console.log('Token:', token);

// Если токен есть, но не добавляется в запросы:
useAuthStore.getState().setAccessToken(token);
```

## Контакты для поддержки
Если проблема не решается:
1. Проверьте логи бэкенда
2. Проверьте логи браузера (Console)
3. Убедитесь что бэкенд запущен на порту 4000
4. Убедитесь что фронтенд запущен на порту 3000

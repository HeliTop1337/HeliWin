# Исправление загрузки изображений

## Что исправлено

### 1. Правильная раздача статических файлов
- В режиме разработки файлы берутся из `uploads/` в корне проекта
- В продакшене из `dist/../uploads/`
- Файлы доступны по URL: `http://localhost:4000/uploads/cases/filename.webp`

### 2. Автоматическое удаление старых файлов
При обновлении или удалении:
- **Кейс**: старая иконка удаляется при замене на новую или удалении кейса
- **Предмет**: старая иконка удаляется при замене на новую или удалении предмета

### 3. Правильное отображение изображений на фронтенде
- Создана утилита `getImageUrl()` для формирования правильных URL
- Добавлена обработка ошибок загрузки (fallback на placeholder)
- Поддержка как локальных файлов, так и внешних URL

## Изменения в коде

### Backend
- `backend/admin/admin.service.ts`:
  - Добавлен метод `deleteFile()` для удаления файлов
  - Обновлены методы `updateCase()`, `deleteCase()`, `updateItem()`, `deleteItem()`
  
- `backend/main.ts`:
  - Исправлен путь к статическим файлам для режима разработки

### Frontend
- `frontend/lib/imageUrl.ts`:
  - Новая утилита для формирования правильных URL изображений
  
- `frontend/pages/admin/cases.tsx`:
  - Использование `getImageUrl()` для всех изображений
  - Добавлена обработка ошибок загрузки

## Как это работает

### Загрузка новой иконки
1. Пользователь выбирает файл
2. Файл загружается в `uploads/cases/` с уникальным именем
3. Если была старая иконка, она удаляется
4. В БД сохраняется путь `/uploads/cases/filename.webp`
5. Фронтенд формирует полный URL: `http://localhost:4000/uploads/cases/filename.webp`

### Удаление кейса/предмета
1. Находим запись в БД
2. Если есть иконка с путем `/uploads/...`, удаляем файл
3. Удаляем запись из БД

## Проверка

После перезапуска сервера:
1. Откройте `/admin/cases`
2. Создайте новый кейс с иконкой
3. Иконка должна отображаться
4. Измените иконку - старая должна удалиться
5. Удалите кейс - иконка должна удалиться

## Troubleshooting

### Изображения не отображаются
- Проверьте, что бэкенд запущен на порту 4000
- Проверьте консоль браузера на ошибки 404
- Убедитесь, что файлы есть в папке `uploads/cases/`

### Старые файлы не удаляются
- Проверьте права доступа к папке `uploads/`
- Проверьте логи бэкенда на ошибки удаления

### 404 ошибки
- Убедитесь, что путь в БД начинается с `/uploads/`
- Проверьте, что файл физически существует
- Перезапустите бэкенд после изменений

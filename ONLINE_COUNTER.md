# ะกัะตััะธะบ ะพะฝะปะฐะนะฝ ะฟะพะปัะทะพะฒะฐัะตะปะตะน

## ะะตะฐะปะธะทะฐัะธั

### ะะพะผะฟะพะฝะตะฝัั

1. **OnlineCounter.tsx** - ะะพะผะฟะพะฝะตะฝั ะพัะพะฑัะฐะถะตะฝะธั ััะตััะธะบะฐ
2. **WebsocketGateway** - ะกะตัะฒะตัะฝะฐั ะปะพะณะธะบะฐ ะฟะพะดััะตัะฐ
3. **Header.tsx** - ะะฝัะตะณัะฐัะธั ะฒ ัะตะดะตั

## ะะฐะบ ัะฐะฑะพัะฐะตั

### 1. ะะพะดะบะปััะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั
```
ะะพะปัะทะพะฒะฐัะตะปั โ WebSocket โ ะกะตัะฒะตั
                โ
         user:online (userId)
                โ
         onlineUsers.set(clientId, userId)
                โ
         broadcastOnlineCount()
```

### 2. ะัะบะปััะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั
```
ะะพะปัะทะพะฒะฐัะตะปั ะพัะบะปััะฐะตััั
         โ
    handleDisconnect()
         โ
    onlineUsers.delete(clientId)
         โ
    broadcastOnlineCount()
```

### 3. ะะฑะฝะพะฒะปะตะฝะธะต ััะตััะธะบะฐ
```
ะกะตัะฒะตั โ online:count โ ะัะต ะบะปะธะตะฝัั
         { count: 27 }
              โ
         setOnlineCount(27)
              โ
         ะัะพะฑัะฐะถะตะฝะธะต: "27 ะะฝะปะฐะนะฝ"
```

## ะะธะทัะฐะป

### ะะฐัะฟะพะปะพะถะตะฝะธะต
ะกัะตััะธะบ ะฝะฐัะพะดะธััั ะฒ ะฟัะฐะฒะพะน ัะฐััะธ ัะตะดะตัะฐ, ะฟะตัะตะด ะฟะตัะตะบะปััะฐัะตะปะตะผ ัะตะผั:

```
Logo  ะะฐะฒะธะณะฐัะธั  [โ27 ะะฝะปะฐะนะฝ] [๐] ะะฐะปะฐะฝั ะัะพัะธะปั
```

### ะกัะธะปั
- ะคะพะฝ: `bg-white/5` (ะฟะพะปัะฟัะพะทัะฐัะฝัะน ะฑะตะปัะน)
- ะัะฐะฝะธัะฐ: `border-white/10` (ัะพะฝะบะฐั ะฑะตะปะฐั)
- Backdrop blur ะดะปั ัััะตะบัะฐ ััะตะบะปะฐ
- ะะตะปะตะฝะฐั ัะพัะบะฐ ั ะฟัะปััะฐัะธะตะน
- ะขะตะบัั: "27 ะะฝะปะฐะนะฝ" (ัะธัะปะพ ะถะธัะฝะพะต, "ะะฝะปะฐะนะฝ" ะฟะพะปัะฟัะพะทัะฐัะฝะพะต)

### ะะพะด
```tsx
<div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 backdrop-blur-sm border border-white/10">
  <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
  <span className="text-sm font-semibold text-white/90">
    {onlineCount} <span className="text-white/60">ะะฝะปะฐะนะฝ</span>
  </span>
</div>
```

## WebSocket ัะพะฑััะธั

### ะะปะธะตะฝั โ ะกะตัะฒะตั

**user:online**
```typescript
socket.emit('user:online', userId);
```
ะัะฟัะฐะฒะปัะตััั ะฟัะธ ะฟะพะดะบะปััะตะฝะธะธ ะฐะฒัะพัะธะทะพะฒะฐะฝะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั.

**user:offline**
```typescript
socket.emit('user:offline');
```
ะัะฟัะฐะฒะปัะตััั ะฟัะธ ะพัะบะปััะตะฝะธะธ ะฟะพะปัะทะพะฒะฐัะตะปั.

### ะกะตัะฒะตั โ ะะปะธะตะฝั

**online:count**
```typescript
socket.on('online:count', (data: { count: number }) => {
  setOnlineCount(data.count);
});
```
ะะพะปััะฐะตั ัะตะบััะตะต ะบะพะปะธัะตััะฒะพ ะพะฝะปะฐะนะฝ ะฟะพะปัะทะพะฒะฐัะตะปะตะน.

## ะะพะณะธะบะฐ ะฟะพะดััะตัะฐ

### ะะฐ ัะตัะฒะตัะต (WebsocketGateway)
```typescript
private onlineUsers = new Map<string, string>();

handleConnection(client: Socket) {
  // ะัะฟัะฐะฒะปัะตะผ ัะตะบััะธะน ััะตััะธะบ ะฝะพะฒะพะผั ะบะปะธะตะฝัั
  this.broadcastOnlineCount();
}

handleUserOnline(client: Socket, userId: string) {
  // ะะพะฑะฐะฒะปัะตะผ ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ ัะฟะธัะพะบ ะพะฝะปะฐะนะฝ
  this.onlineUsers.set(client.id, userId);
  this.broadcastOnlineCount();
}

handleDisconnect(client: Socket) {
  // ะฃะดะฐะปัะตะผ ะฟะพะปัะทะพะฒะฐัะตะปั ะธะท ัะฟะธัะบะฐ ะพะฝะปะฐะนะฝ
  this.onlineUsers.delete(client.id);
  this.broadcastOnlineCount();
}

private broadcastOnlineCount() {
  this.server.emit('online:count', {
    count: this.onlineUsers.size,
  });
}
```

### ะะฐ ะบะปะธะตะฝัะต (OnlineCounter)
```typescript
const [onlineCount, setOnlineCount] = useState(0);

useEffect(() => {
  const socket = io('http://localhost:4000');
  
  socket.on('connect', () => {
    if (isAuthenticated && user) {
      socket.emit('user:online', user.id);
    }
  });
  
  socket.on('online:count', (data) => {
    setOnlineCount(data.count);
  });
  
  return () => {
    if (isAuthenticated && user) {
      socket.emit('user:offline');
    }
    socket.close();
  };
}, [isAuthenticated, user]);
```

## ะัะพะฑะตะฝะฝะพััะธ

### 1. ะขะพะปัะบะพ ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ
ะกัะตััะธะบ ััะธัะฐะตั ัะพะปัะบะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน, ะบะพัะพััะต:
- ะะฒัะพัะธะทะพะฒะฐะฝั (isAuthenticated = true)
- ะะผะตัั user.id
- ะัะฟัะฐะฒะธะปะธ ัะพะฑััะธะต `user:online`

### 2. ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต
ะกัะตััะธะบ ะพะฑะฝะพะฒะปัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ:
- ะะพะดะบะปััะตะฝะธะธ ะฝะพะฒะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
- ะัะบะปััะตะฝะธะธ ะฟะพะปัะทะพะฒะฐัะตะปั
- ะะตัะตะฟะพะดะบะปััะตะฝะธะธ ะฟะพัะปะต ะพะฑััะฒะฐ ัะฒัะทะธ

### 3. ะะตะฐะบัะธะฒะฝะพััั
ะัะต ะฟะพะดะบะปััะตะฝะฝัะต ะบะปะธะตะฝัั ะฟะพะปััะฐัั ะพะฑะฝะพะฒะปะตะฝะธะต ััะตััะธะบะฐ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ.

### 4. ะัะธััะบะฐ ะฟัะธ ะพัะบะปััะตะฝะธะธ
ะัะธ ะทะฐะบัััะธะธ ัััะฐะฝะธัั ะธะปะธ ะฒััะพะดะต ะฟะพะปัะทะพะฒะฐัะตะปั:
```typescript
return () => {
  if (isAuthenticated && user) {
    socket.emit('user:offline');
  }
  socket.close();
};
```

## ะขะตััะธัะพะฒะฐะฝะธะต

### 1. ะัะบัะพะนัะต ัะฐะนั ะฒ ะฝะตัะบะพะปัะบะธั ะฒะบะปะฐะดะบะฐั
```
ะะบะปะฐะดะบะฐ 1: ะะฒัะพัะธะทัะนัะตัั โ ะกัะตััะธะบ: 1 ะะฝะปะฐะนะฝ
ะะบะปะฐะดะบะฐ 2: ะะฒัะพัะธะทัะนัะตัั โ ะกัะตััะธะบ: 2 ะะฝะปะฐะนะฝ
ะะบะปะฐะดะบะฐ 3: ะะฒัะพัะธะทัะนัะตัั โ ะกัะตััะธะบ: 3 ะะฝะปะฐะนะฝ
```

### 2. ะะฐะบัะพะนัะต ะฒะบะปะฐะดะบั
```
ะะฐะบัััั ะฒะบะปะฐะดะบั 3 โ ะกัะตััะธะบ: 2 ะะฝะปะฐะนะฝ
```

### 3. ะัะนะดะธัะต ะธะท ะฐะบะบะฐัะฝัะฐ
```
Logout โ ะกัะตััะธะบ: 1 ะะฝะปะฐะนะฝ
```

### 4. ะัะพะฒะตัััะต ะบะพะฝัะพะปั
```
OnlineCounter: Connected to WebSocket
OnlineCounter: Received online count 3
```

## ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั

- [ ] ะะพะบะฐะทัะฒะฐัั ัะฟะธัะพะบ ะพะฝะปะฐะนะฝ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฟัะธ ะบะปะธะบะต
- [ ] ะะฐะทะดะตะปะตะฝะธะต ะฝะฐ ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัั ะธ ะณะพััะตะน
- [ ] ะะฝะธะผะฐัะธั ะธะทะผะตะฝะตะฝะธั ัะธัะปะฐ
- [ ] ะะบะพะฝะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒะผะตััะพ ัะพัะบะธ
- [ ] Tooltip ั ะดะพะฟะพะปะฝะธัะตะปัะฝะพะน ะธะฝัะพัะผะฐัะธะตะน

## ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
frontend/
  components/
    OnlineCounter.tsx     โ ะะพะฒัะน ะบะพะผะฟะพะฝะตะฝั
    Header.tsx            โ ะะฑะฝะพะฒะปะตะฝ (ะดะพะฑะฐะฒะปะตะฝ OnlineCounter)

backend/
  websocket/
    websocket.gateway.ts  โ ะะฑะฝะพะฒะปะตะฝ (ะปะพะณะธะบะฐ ะฟะพะดััะตัะฐ)
```

## ะะธะทัะฐะปัะฝัะน ัะตะทัะปััะฐั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Logo  ะะตะนัั  Crash  ...  [โ27 ะะฝะปะฐะนะฝ] [๐] ะะฐะปะฐะฝั  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
    ะะตะปะตะฝะฐั ัะพัะบะฐ ะฟัะปััะธััะตั
    ะงะธัะปะพ ะพะฑะฝะพะฒะปัะตััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
```
